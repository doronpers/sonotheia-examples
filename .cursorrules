# Sonotheia Examples - Agent Rules

You are an AI coding assistant working on the **Sonotheia Examples** repository.

## CRITICAL: Read Before ANY Task

Before starting any task, you MUST read and follow: `AGENT_KNOWLEDGE_BASE.md` in the repository root.

This file contains:

- Prime directives (patent compliance, security, design philosophy)
- Coding standards (black, flake8, Pydantic)
- Example development guidelines
- Testing requirements

## Quick Rules

1. **PATENT COMPLIANCE**: NEVER use LPC, source-filter models, or static formant values
2. **Format**: Use `black` for Python
3. **Style**: `snake_case` for functions, `PascalCase` for classes
4. **Security**: NEVER log API keys, PII, or raw audio bytes
5. **Reasoning Logs**: After significant tasks (complex, architectural, refactoring, non-obvious bug fixes), create log entry at `feedback-loop/agent_reasoning_logs/logs/YYYY-MM-DD_sonotheia-examples_task.md` (see template: `feedback-loop/agent_reasoning_logs/templates/reasoning_entry.md`)
6. **Examples**: Must be runnable with minimal setup
7. **IDE Setup**: Enable "Format on Save" and configure linter to use `.pre-commit-config.yaml` (see AGENT_KNOWLEDGE_BASE.md)
8. **Bulk Operations**: Use `git diff --stat` to audit changes, then run `python3 -m compileall .` before committing (see AGENT_KNOWLEDGE_BASE.md)

## Key Commands

```bash
black .              # Format
flake8 .             # Lint
pytest               # Test
```

## Pre-Commit Hook Requirements (MANDATORY)

**CRITICAL**: Before creating new code, ensure you:

1. **Include ALL required imports** - Check existing similar files for import patterns
2. **Add type hints** - All new functions need type annotations
3. **Format docstrings correctly** - One-line: `"""Description."""` (no blank line)
4. **Handle FastAPI Depends()** - Use `# noqa: B008` for `Depends()` in function signatures
5. **Check YAML indentation** - Use 2 spaces consistently
6. **Remove unused imports** - Especially in test files
7. **Run pre-commit hooks** - Execute `pre-commit run --all-files` before committing

**Common failures to avoid:**
- Missing imports (mypy: "Name X is not defined")
- Unused imports (flake8: F401)
- Wrong YAML indentation (yamllint: indentation errors)
- Missing docstrings (flake8: D104, D200)
- Long lines (flake8: E501)

**Always run the pre-commit checklist before finishing:**
```bash
black . && flake8 . && mypy examples/python/ && yamllint . && pre-commit run --all-files
```

**See `.agent/workflows/pre-commit-checklist.md` for detailed checklist and common fixes.**

## Audio Format

All audio must be **float32 mono numpy arrays at 16kHz**

## Planning & Roadmap Guidelines

### Time Estimation Rule

**Rule for Future Planning Agents**: When creating plans or roadmaps:

1. **Do NOT include time estimates** (days, weeks, months) unless you have:
   - Actual historical data from similar completed tasks in the same codebase
   - Verified duration data from project management systems
   - User-provided time constraints

2. **Instead, use**:
   - **Complexity indicators**: Low, Medium, High, Very High
   - **Effort indicators**: Small, Medium, Large
   - **Dependencies**: List blocking dependencies
   - **Prerequisites**: What must be done first

3. **If time estimates are requested**:
   - Base them on similar completed tasks in the codebase
   - Clearly state the assumptions and data sources
   - Mark estimates as "rough" or "tentative"
   - Prefer ranges over specific dates

4. **Rationale**: Time estimates are highly variable and depend on:
   - Developer experience and familiarity
   - Unexpected technical challenges
   - External dependencies
   - Scope changes during implementation
   - Context switching and interruptions

This rule should be followed when updating ROADMAP.md or any planning documents.
